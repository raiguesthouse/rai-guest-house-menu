import React, { useState } from "react";
import { Card, CardContent } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";

const menuItems = [
  { name: "Plain Tawa Roti", price: 10 },
  { name: "Butter Roti", price: 13 },
  { name: "Jeera Rice", price: 120 },
  { name: "Shahi Paneer", price: 200 },
  { name: "Special Thali", price: 200 },
];

export default function MenuOrder() {
  const [cart, setCart] = useState([]);
  const [customerInfo, setCustomerInfo] = useState({ mobile: "", room: "" });

  const addToCart = (item) => {
    setCart((prev) => {
      const existingItem = prev.find((i) => i.name === item.name);
      if (existingItem) {
        return prev.map((i) =>
          i.name === item.name ? { ...i, quantity: i.quantity + 1 } : i
        );
      }
      return [...prev, { ...item, quantity: 1 }];
    });
  };

  const updateQuantity = (index, quantity) => {
    setCart((prev) =>
      prev.map((item, i) => (i === index ? { ...item, quantity } : item))
    );
  };

  const removeItem = (index) => {
    setCart((prev) => prev.filter((_, i) => i !== index));
  };

  const handleOrder = () => {
    const total = cart.reduce((acc, item) => acc + item.price * item.quantity, 0);
    const orderDetails = cart
      .map((item) => `${item.name} x${item.quantity} = ‚Çπ${item.price * item.quantity}`)
      .join("\n");
    
    const emailBody = `Room No: ${customerInfo.room}\nMobile: ${customerInfo.mobile}\n\nOrder Details:\n${orderDetails}\n\nTotal: ‚Çπ${total}`;
    window.location.href = `mailto:aakashraiofficialmail@gmail.com?subject=New Order&body=${encodeURIComponent(emailBody)}`;
  };

  return (
    <div className="p-4 max-w-lg mx-auto">
      <h1 className="text-2xl font-bold mb-4">üìú Rai Guest House Menu</h1>
      <div className="grid grid-cols-1 gap-4">
        {menuItems.map((item) => (
          <Card key={item.name} className="p-4 flex justify-between items-center">
            <CardContent>{item.name} - ‚Çπ{item.price}</CardContent>
            <Button onClick={() => addToCart(item)}>Add</Button>
          </Card>
        ))}
      </div>
      <h2 className="text-xl font-bold mt-6">üõí Your Order</h2>
      {cart.length === 0 ? (
        <p>No items added</p>
      ) : (
        cart.map((item, index) => (
          <div key={index} className="flex justify-between items-center p-2 border">
            <span>{item.name} (‚Çπ{item.price})</span>
            <input
              type="number"
              className="w-12 text-center border"
              value={item.quantity}
              min={1}
              onChange={(e) => updateQuantity(index, parseInt(e.target.value) || 1)}
            />
            <Button variant="destructive" onClick={() => removeItem(index)}>
              ‚ùå
            </Button>
          </div>
        ))
      )}
      <h2 className="text-lg font-bold mt-4">Total: ‚Çπ{cart.reduce((acc, item) => acc + item.price * item.quantity, 0)}</h2>
      <div className="mt-4">
        <Input
          placeholder="Enter Mobile Number"
          value={customerInfo.mobile}
          onChange={(e) => setCustomerInfo({ ...customerInfo, mobile: e.target.value })}
        />
        <Input
          placeholder="Enter Room Number"
          value={customerInfo.room}
          onChange={(e) => setCustomerInfo({ ...customerInfo, room: e.target.value })}
        />
        <Button className="w-full mt-4" onClick={handleOrder} disabled={!customerInfo.mobile || !customerInfo.room || cart.length === 0}>
          Place Order
        </Button>
      </div>
    </div>
  );
}
